# Study Case 1

## 0. Guidance

- Create your own github account ([https://github.com/](https://github.com/))
- Create your local repository (git init)
- Initialize npm or yarn (npm init or yarn init)
- Push your local repository into github
- Use your favorite IDEA (VsCode, Sublime, Atom, etc)
- add .gitignore file in the app directory (you can generate it from [https://www.gitignore.io/](https://www.gitignore.io/))
- Create a class Account to reflect the domain model that you want to work to.
- Use JSON as a data source
- Use EJS as template engine (Please prioritize the functionalities not the design)
- Commit your code anytime when you are sure with that code, don't forget to add the meaningful message in each commit.
- Don't forget to push your code into your Git repository at least once every day
- Your application must be able to run with the following command :
  node index.ts

## 1. ATM Simulation (White belt)

A Program which simulate the functionalities of ATM

- ### ATM contains two records with the following details:

  - ```
    Name : John Doe
    PIN : 012108
    Balance : $100
    Account Number: 112233`
    ```
  - ```
    Name : Jane Doe
    PIN : 932012
    Balance : $30
    Account Number: 112244
    ```

- ### Login page

  ```
  Enter Account Number: 112233
  Enter PIN: 443322
  ```

  - Account Number should have 6 digits length. Display message `Account Number should have 6 digits length` for invalid Account Number.
  - Account Number should only contains numbers [0-9]. Display message `Account Number should only contains numbers` for invalid Account Number.
  - PIN should have 6 digits length. `Display message PIN should have 6 digits length` for invalid PIN.
  - PIN should only contains numbers [0-9]. Display message `PIN should only contains numbers` for invalid PIN.
  - Check valid Acccount Number & PIN with ATM records. Display message `Invalid Account Number/PIN` if records is notexist.
  - Valid Account Number & PIN will take user to `Transaction Screen`.

- ### Transaction Page

  ```
  - Withdraw [link]
  - Fund Transfer [link]
  - History [link]
  - Exit [link]
  ```

  - Withdraw : Redirect user to Withdraw page
  - Fund Transfer : Redirect user to Fund Transfer page
  - History Page : Redirect user to Fund History page
  - Exit : Redirect user to Login page

- ### Withdraw Page

  #### Page :

  ```
  Please input withdraw amount (multiple of $10) :
  [Number input]

  [Submit button] [Back button]
  ```

  #### Confirmation Pop up

  ```
  Withdraw Confirmation
  Withdraw Amount     : $yy

  [Withdraw button] [Cancel button]
  ```

  - Back button will redirect user to Transaction Page.
  - Submit button will open confirmation pop up.
  - Cancel button will close confirmation pop up.
  - Withdraw button will trigger form submission and validation.
  - Maximum amount to withdraw is $1000. Display message `Maximum amount to withdraw is $1000` if withdraw amountis higher than $1000.
  - Display message `Invalid ammount` if withdraw amount is not numbers.
  - Display message `Invalid ammount` if withdraw amount is not multiple of $10.
  - Display message `Insufficient balance $10` for insufficient balance. $10 is the withdraw amount
  - Valid amount will deduct the user balance with withdraw amount and go to Transaction Page with success message `Withdraw success`.

- ### Fund Transfer Page

  #### Page :

  ```
  Please enter destination account :
  [Number input]

  Please enter transfer amount :
  [Number input]

  Reference Number: (This is an autogenerated random 6 digits number) :
  [Number input]

  [Submit button] [Back button]
  ```

  #### Confirmation Pop up

  ```
  Transfer Confirmation
  Destination Account : xxx-xxx-xxx-x
  Transfer Amount     : $yy
  Reference Number    : zzzzzzzzzzzzz

  [Transfer button] [Cancel button]
  ```

  - Back button will redirect user to Transaction Page.
  - Submit button will open confirmation pop up.
  - Cancel button will close confirmation pop up.
  - Transfer button will trigger form submission and validation.
  - Display message `Invalid account` if account is not numbers.
  - Display message `Invalid account` if account is not found.
  - Maximum amount to transfer is $1000. Display message `Maximum amount to withdraw is $1000` if transfer amount ishigher than $1000.
  - Minimum amount to transfer is $1. Display message `Minimum amount to withdraw is $1` if transfer amount is lowerthan $1.
  - Display message `Invalid amount` if transfer amount is not numbers.
  - Display message `Insufficient balance $300` for insufficient balance. $300 is the transfer amount
  - Display message `Invalid Reference Number` if reference number is not empty and not numbers
  - Valid amount will deduct the user balance with transfer amount and will add destination account with transfer amount. After that screen will go to Transaction Page with alert message `Withdraw success`.

- ### History Page

  ```
  Transaction History :

  Date : 2019-02-30 10:00 AM
  Transaction ID : TF-#ACCOUNT_DESTINATION_NUMBER#REF_NUMBER#TIMESTAMP
  Transaction type : Transfer
  Amount : $30
  Current Balance : $60

  Date : 2019-02-30 09:00 AM
  Transaction ID : WD-#TIMESTAMP
  Transaction type : Withdraw
  Amount : $10
  Current Balance : $90

  Date : 2019-02-30 08:00 AM
  Transaction ID : TF-#ACCOUNT_DESTINATION_NUMBER#REF_NUMBER#TIMESTAMP
  Transaction type : Transfer
  Amount : $20
  Current Balance : $100

  [Back button]
  ```

  - Back button will redirect user to Transaction Page without success message
  - Submit button will trigger form submission and validation
  - Maximum amount to withdraw is $1000. Display message `Maximum amount to withdraw is $1000` if withdraw amountis higher than $1000.
  - Display message `Invalid ammount` if withdraw amount is not numbers.
  - Display message `Invalid ammount` if withdraw amount is not multiple of $10.
  - Display message `Insufficient balance $10` for insufficient balance. $10 is the withdraw amount
  - Valid amount will deduct the user balance with withdraw amount and go to Transaction Page with success message `Withdraw success`.

## 2. Implement Typescript & Code Standards (Yellow Belt)

Up to this point, you have learned basic git & github for version controlling your project. you also practice to create simple app using Javascript and Node JS. at this level you will implement typescript on your previous application and make standards for your code.

for this stage the requirements are :

- Implement typescript on your application ()
- Try to not ignoring any typescript rules
- the code should running with `npm run start`
- Lint your code using eslint (https://eslint.org/)
- Standarize your code using prettier (https://prettier.io/)

## 3. Create Rest Api with Express, Simple Authentification, Testing, and Database Integeration (Orange Belt)

### A. Create Rest Api With Express

let's turn your application into rest api with express. at this level you will learn how to create an api from requirements documentation. also you will practice to create middleware for auth, unit testing, and database integeration.

for this stage the requirements are :

- Use latest express version
- Use common used simple project structure (routes, controllers, services, models, helpers, middlewares, types, workers, etc..)
- Create endpoints based on API documentation below
- Use mongodb as database
- Create your own schema based on API documentation below
- Use mongose to manage mongodb
- Use JWT for authentification
- Generate token based on user schema
- Generate JWT token and save to related user table on token column everytime user logged in
- Create middleware user authentification and authorization
- Some of endpoints may have different result based on role that can be read from token
- Please read the api documentation carefully make sure everything is working
- You will not using EJS anymore, use postman as your GUI
- Use Mocha as testing library
- Add test code coverage. and total code coverage should > 90%

### [ POST ] Endpoint : /login

#### Description : this endpoint will authenticate the user. use middleware for authentification. token will be included in the response. user will save their token on client side.

#### Request :

<table>
<tr>
<th width="25%">  query </th>
<th width="25%">  params </th>
<th width="25%">  body </th>
<th width="25%"> headers </th>
</tr>

<tr>
<td>-</td>
<td>-</td>
<td>

```json
{
  "accountNumber": "1238213",
  "pin": "123321"
}
```

</td>
<td>-</td>
</tr>
</table>

#### Response :

<table>
  <tr>
    <th> Status </th>
    <th> Response </th>
  </tr>

  <tr>
  <td> 200 </td>
  <td>

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "accountNumber": "218213728",
    "pin": "12321",
    "name": "Muhammad Badar",
    "role": "user",
    "balance": 12350,
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
  }
}
```

  </td>
  </tr>

  <tr>
  <td> 400 </td>
  <td>
  <br/>
  This is the response when user input is invalid. the message property should be depend on the validation error <br/><br/>

```json
{
  "code": 400,
  "message": "Account Number should have 6 digits length",
  "data": null
}
```

  </td>
  </tr>

  <tr>
  <td> 500 </td>
  <td>
  <br/>
  This is the response when error occured from application side <br/><br/>

```json
{
  "code": 500,
  "message": "Internal Server Error",
  "data": null
}
```

  </td>
  </tr>
</table>

### [ POST ] Endpoint : /withdraw

#### Description : User want to withdraw their money, validate the user request. and make sure the balance is enough. when all validation is valid, deduct the user balance with the amount requested. this endpoint only can be accessed for user with role "user" if admin access this endpoint please give 403 response.

#### Request :

<table>
<tr>
<th width="25%">  query </th>
<th width="25%">  params </th>
<th width="25%">  body </th>
<th width="25%"> headers </th>
</tr>

<tr>
<td>-</td>
<td>-</td>
<td>

```json
{
  "amount": 50
}
```

</td>
<td>

```json
{
  "Authorization": {token}
}
```

</td>
</tr>
</table>

#### Response :

<table>
  <tr>
    <th> Status </th>
    <th> Response </th>
  </tr>

  <tr>
  <td> 200 </td>
  <td>

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "transactionId": "WD-#1669164753",
    "transactionType": "withdraw",
    "transactionRefNumber": "",
    "currentBalance": 215,
    "amount": 50,
    "transactionDate": "2019-02-30 09:00 AM"
  }
}
```

  </td>
  </tr>

  <tr>
  <td> 403 </td>
  <td>
  <br/>
  This is the response when token is not provided or invalid <br/><br/>

```json
{
  "code": 403,
  "message": "You are unaothorized!",
  "data": null
}
```

  </td>
  </tr>

  <tr>
  <td> 400 </td>
  <td>
  <br/>
  This is the response when user input is invalid. the message property should be depend on the validation error <br/><br/>

```json
{
  "code": 400,
  "message": "Amount must a number",
  "data": null
}
```

  </td>
  </tr>

  <tr>
  <td> 500 </td>
  <td>
  <br/>
  This is the response when error occured from application side <br/><br/>

```json
{
  "code": 500,
  "message": "Internal Server Error",
  "data": null
}
```

  </td>
  </tr>
</table>

### [ POST ] Endpoint : /transfer/${account_number_destination}

#### Description : User want to transfer their money to different account, validate the user request. and make sure the balance is enough. you also need to check whether the destination is exist. when all validation is valid, deduct the user balance with the amount requested. this endpoint only can be accessed for user with role "user" if admin access this endpoint please give 403 response.

#### Request :

<table>
<tr>
<th width="25%">  query </th>
<th width="25%">  params </th>
<th width="25%">  body </th>
<th width="25%"> headers </th>
</tr>

<tr>
<td>-</td>
<td>-</td>
<td>

```json
{
  "refNumber": "",
  "amount": 50
}
```

</td>
<td>

```json
{
  "Authorization": {token}
}
```

</td>
</tr>
</table>

#### Response :

<table>
  <tr>
    <th> Status </th>
    <th> Response </th>
  </tr>

  <tr>
  <td> 200 </td>
  <td>

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "transactionId": "TF-#123213#8273645#1669164753",
    "transactionType": "transfer",
    "transactionRefNumber": "8273645",
    "currentBalance": 215,
    "amount": 50,
    "transactionDate": "2019-02-30 09:00 AM",
    "destination": {
      "accountNumber": "218213728",
      "name": "Muhammad Badar"
    }
  }
}
```

  </td>
  </tr>

  <tr>
  <td> 403 </td>
  <td>
  <br/>
  This is the response when token is not provided or invalid <br/><br/>

```json
{
  "code": 403,
  "message": "You are unaothorized!",
  "data": null
}
```

  </td>
  </tr>

  <tr>
  <td> 404 </td>
  <td>
  <br/>
  This is the response when destination account number is not exist <br/><br/>

```json
{
  "code": 404,
  "message": "Destination account is not exist",
  "data": null
}
```

  </td>
  </tr>

  <tr>
  <td> 400 </td>
  <td>
  <br/>
  This is the response when user input is invalid. the message property should be depend on the validation error <br/><br/>

```json
{
  "code": 400,
  "message": "Amount must a number",
  "data": null
}
```

  </td>
  </tr>

  <tr>
  <td> 500 </td>
  <td>
  <br/>
  This is the response when error occured from application side <br/><br/>

```json
{
  "code": 500,
  "message": "Internal Server Error",
  "data": null
}
```

  </td>
  </tr>
</table>

### [ GET ] Endpoint : /transaction

#### Description : User want to see their transaction history, add pagination and filter from date range. return array of data based on filter and pagination object.

#### Request :

<table>
<tr>
<th width="25%">  query </th>
<th width="25%">  params </th>
<th width="25%">  body </th>
<th width="25%"> headers </th>
</tr>

<tr>
<td>

```json
{
  "page": 1,
  "limit": 10,
  "start_date": "2019-02-30",
  "end_date": "2019-03-10"
}
```

</td>
<td>-</td>
<td>-</td>
<td>

```json
{
  "Authorization": {token}
}
```

</td>
</tr>
</table>

#### Response :

<table>
  <tr>
    <th> Status </th>
    <th> Response </th>
  </tr>

  <tr>
  <td> 200 </td>
  <td>

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "transactions": [
      {
        "transactionId": "TF-#123213#8273645#1669164753",
        "transactionType": "transfer",
        "transactionRefNumber": "8273645",
        "currentBalance": 215,
        "amount": 5,
        "transactionDate": "2019-03-05 09:00 AM"
      },
      {
        "transactionId": "WD-#1669164753",
        "transactionType": "withdraw",
        "transactionRefNumber": "",
        "currentBalance": 220,
        "amount": 5,
        "transactionDate": "2019-03-03 09:00 AM"
      },
      {
        "transactionId": "WD-#1669164753",
        "transactionType": "withdraw",
        "transactionRefNumber": "",
        "currentBalance": 225,
        "amount": 5,
        "transactionDate": "2019-02-30 09:00 AM"
      }
    ],
    "pagination": {
      "total_rows": 215,
      "limit": 5,
      "currentPage": 3
    }
  }
}
```

  </td>
  </tr>

  <tr>
  <td> 403 </td>
  <td>
  <br/>
  This is the response when token is not provided or invalid <br/><br/>

```json
{
  "code": 403,
  "message": "You are unaothorized!",
  "data": null
}
```

  </td>
  </tr>

  <tr>
  <td> 400 </td>
  <td>
  <br/>
  This is the response when user input is invalid. the message property should be depend on the validation error <br/><br/>

```json
{
  "code": 400,
  "message": "Amount must a number",
  "data": null
}
```

  </td>
  </tr>

  <tr>
  <td> 500 </td>
  <td>
  <br/>
  This is the response when error occured from application side <br/><br/>

```json
{
  "code": 500,
  "message": "Internal Server Error",
  "data": null
}
```

  </td>
  </tr>
</table>

## 4. Create asynchronus function (RabbitMQ), CRON job, Realtime notification (Socket.io), and PM2 (Green Belt)

This is the last level of Node JS study case. At this level you will learn how to create asynchronus function with RabbitMQ, CRON job, Realtime notification with Socket.io and deploy the application on your machine.

### 1. Asynchronus function (Rabbit MQ) and Realtime Notification (Socket.io)

Imagine admin want to collect whole transaction data. the data have 10M rows. it will takes 5 minutes to fetch the data from database and 4 minutes to generate the csv file. the client can't wait for 9 minutes since the request will be terminated since we only set 5 miniutes before the connection is timeout.

That is why we need asynchronus function, function that will running in the background. and we will create task that will queued and we will notify the client with Socket.io for realtime notification.

#### The requirements for this module:

- #### Create new endpoint to request csv file url

  Create new endpoint /transaction/csv with GET Method. at this endpoint we will add task to your queue system. and always return 200 to client without waiting for file creation finished.

- #### Create Socket.io service

  You need to create socket.io service for realtime communication between client app and core app.

- #### Create new task on RabbitMQ for history csv file creation

  You need to install RabbitMQ and create new queue to queueing task for csv file creation

- #### Create publisher with RabbitMQ
  You need to create new publisher task that will fetch the whole transaction data and generate to csv file that would be saved on your public directory in your application. after file creation is completed create response object and put in to the queue
- #### Create subscriber with RabbitMQ
  After response object received. notify the socket.io client with url provided.

#### Module flow :

![alt text](https://automate.sgp1.digitaloceanspaces.com/matamantra-assets/77acfd9e-c5e7-4a67-bb39-72c3a7b278c51669173329599.png "image Title")

### 2. CRON JOB

Let's imagine your bank have interest 0.25% of each account current balance. the interest will be given every day at 00:00 AM. at this level you will practive how to use CRON JOB to schedule an action.

#### The requirements for this module:

- Create CRON JOB to execute function every day at 00:00.
- the function is to increase all of user balance 0.25% from their current balance
- Implement RabbitMQ for queue system

### 3. DEPLOY YOUR APP WITH PM2

Deploy your Node JS App on AWS. Make sure to provision a machine with Linux and install all the requirements. use PM2 to start your application and NGINX for the Web Service

#### The requirements for this module:

- Build deploy.sh file that will execute several command to run the application
- Setup NGINX and allow cors to all request
- Run your application under PM2
